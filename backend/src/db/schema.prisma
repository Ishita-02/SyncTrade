generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Leader {
  id             Int         @id @default(autoincrement())
  leaderId       Int?         @unique
  address        String
  meta           String?
  feeBps         Int         @default(0)
  totalFollowers Int         @default(0)
  totalDeposits  Decimal     @default(0)
  feesAccrued    Decimal     @default(0)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  followers      Follower[]
  positions      Position[]
  events         EventLog[]
}

model Follower {
  id           Int         @id @default(autoincrement())
  leaderId     Int
  address      String
  deposit      Decimal     @default(0)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  leader       Leader      @relation(fields: [leaderId], references: [leaderId])
  positions    Position[]  @relation("FollowerPositions")
  events       EventLog[]  @relation("FollowerEvents")
  @@unique([leaderId, address])
}

model Position {
  id           Int        @id @default(autoincrement())
  leaderId     Int
  followerId   Int?       
  action       String
  isLong       Boolean
  entryPrice   Decimal
  exitPrice    Decimal?
  sizeUsd      Decimal
  pnlUsd       Decimal?
  isOpen       Boolean
  indexToken   String?
  txHash       String?
  timestamp    DateTime   @default(now())
  leader       Leader     @relation(fields: [leaderId], references: [leaderId])
  follower     Follower?  @relation("FollowerPositions", fields: [followerId], references: [id])
}

model EventLog {
  id          Int        @id @default(autoincrement())
  leaderId    Int?
  followerId  Int?      
  event       String
  args        Json
  txHash      String?
  blockNumber Int?
  createdAt   DateTime   @default(now())
  leader      Leader?    @relation(fields: [leaderId], references: [leaderId])
  follower    Follower?  @relation("FollowerEvents", fields: [followerId], references: [id])
}
